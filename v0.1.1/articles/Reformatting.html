<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reformatting • dunlin</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reformatting">
<meta property="og:description" content="dunlin">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dunlin</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Reformatting.html">Reformatting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/insightsengineering/dunlin" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reformatting</h1>
            
            <h4 data-toc-skip class="date">2022-10-14</h4>
      
      
      <div class="hidden name"><code>Reformatting.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Reformatting in <code>dulin</code> consists in replacing
predetermined values by another in particular variables for selected
tables of a data set stored under the form of a <code>dm</code>
object.</p>
<p>This is performed in two steps:</p>
<ol style="list-style-type: decimal">
<li><p>A Reformatting Map (<code>list</code> object) is created which
specifies the correspondence between the old and the new values</p></li>
<li><p>The reformatting itself is performed with the
<code><a href="../reference/apply_reformat.html">dunlin::apply_reformat()</a></code> function.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="the-formatting-map-structure">The Formatting Map Structure<a class="anchor" aria-label="anchor" href="#the-formatting-map-structure"></a>
</h2>
<p>The Reformatting Map is a list object with 4 hierarchic levels.</p>
<ol style="list-style-type: decimal">
<li><p>The Table Name: Typically one of the values returned by
<code>names(db)</code> where db is <code>dm</code> object. For instance,
in the case of an <code>adam</code> data set, <code>adsl</code> or
<code>adae</code> etc…</p></li>
<li><p>The Variable Name: The name of the column in a table of a
<code>dm</code> object. For instance <code>ACTARM</code>.</p></li>
<li><p>The Key: the new value that will replace the old ones</p></li>
<li><p>The Values: a vector or values, that have to be replaced by their
associated key.</p></li>
</ol>
<p>The <code>All</code> keyword, in HIGHER, lower or Mixed case, can be
used instead of a table name to indicate that a particular variable
should be changed in every table where it appears.</p>
<p>The values can be a <code>string</code>, a <code>character</code>
vector or <code>NA</code>. Values that are present in the original table
and not listed in the mapping are left unchanged, except that all
altered columns are turned into <code>factor</code> class. If the
original variable is a <code>factor</code>, the non-transformed levels
are preserved even if the corresponding value does not appear.</p>
<p>The order in which the keys appear determine the order of the levels
in the output. Hence the function can be used to re level variables.
However, the level replacing missing values will automatically be placed
last.</p>
<div class="section level4">
<h4 id="example-of-reformatting-map">Example of Reformatting Map<a class="anchor" aria-label="anchor" href="#example-of-reformatting-map"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">my_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># This is the Table Name.</span></span>
<span>  airlines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># This is the Variable Name.</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="co"># `AE` is the Key, `c("American Airlines Inc.")` is the value.</span></span>
<span>      <span class="st">"AE"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"American Airlines Inc."</span><span class="op">)</span>,</span>
<span>      <span class="st">"Alaska and Hawaiian Airlines"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alaska Airlines Inc."</span>, <span class="st">"Hawaiian Airlines Inc."</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  planes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    manufacturer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"Airbus"</span> <span class="op">=</span> <span class="st">"AIRBUS INDUSTRIE"</span>,</span>
<span>      <span class="st">"New Level"</span> <span class="op">=</span> <span class="st">"new_level"</span>,</span>
<span>      <span class="st">"&lt;Missing&gt;"</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span>,</span>
<span>    model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"EMB-145"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EMB-145XR"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Other 737"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"737-824"</span>, <span class="st">"737-724"</span>, <span class="st">"737-732"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  All <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"Current"</span> <span class="op">=</span> <span class="st">"2013"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="re-formatting">Re Formatting<a class="anchor" aria-label="anchor" href="#re-formatting"></a>
</h2>
<p>Once the re formatting map is defined, the reformatting can be
performed on a <code>dm</code> object.</p>
<div class="section level4">
<h4 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">::</span><span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_nycflights13.html" class="external-link">dm_nycflights13</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_zoom_to.html" class="external-link">dm_zoom_to</a></span><span class="op">(</span><span class="va">planes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>manufacturer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">manufacturer</span> <span class="op">==</span> <span class="st">"EMBRAER"</span>, <span class="cn">NA</span>, <span class="va">manufacturer</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_zoom_to.html" class="external-link">dm_update_zoomed</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_reformat.html">apply_reformat</a></span><span class="op">(</span><span class="va">db</span>, format <span class="op">=</span> <span class="va">my_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">airlines</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Endeavor Air Inc."        "American Airlines Inc."  </span></span>
<span><span class="co">#&gt; [3] "Alaska Airlines Inc."     "JetBlue Airways"         </span></span>
<span><span class="co">#&gt; [5] "Delta Air Lines Inc."     "ExpressJet Airlines Inc."</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">airlines</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Endeavor Air Inc.            AE                          </span></span>
<span><span class="co">#&gt; [3] Alaska and Hawaiian Airlines JetBlue Airways             </span></span>
<span><span class="co">#&gt; [5] Delta Air Lines Inc.         ExpressJet Airlines Inc.    </span></span>
<span><span class="co">#&gt; 14 Levels: AE Alaska and Hawaiian Airlines ... Virgin America</span></span>
<span></span>
<span><span class="co"># New levels are introduced and missing values can be replaced.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">planes</span><span class="op">$</span><span class="va">manufacturer</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA                 "AIRBUS INDUSTRIE" NA                 "AIRBUS INDUSTRIE"</span></span>
<span><span class="co">#&gt; [5] "AIRBUS INDUSTRIE" NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">planes</span><span class="op">$</span><span class="va">manufacturer</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] &lt;Missing&gt; Airbus    &lt;Missing&gt; Airbus    Airbus    &lt;Missing&gt;</span></span>
<span><span class="co">#&gt; 16 Levels: Airbus New Level AIRBUS BEECH BOEING BOMBARDIER INC ... &lt;Missing&gt;</span></span>
<span></span>
<span><span class="co"># Using the `All` keyword changes several tables.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2013 2013 2013 2013 2013 2013</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Current Current Current Current Current Current</span></span>
<span><span class="co">#&gt; Levels: Current</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">flights</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2013 2013 2013 2013 2013 2013</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">flights</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Current Current Current Current Current Current</span></span>
<span><span class="co">#&gt; Levels: Current</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="reformatting-map-with-null-values">Reformatting Map with <code>NULL</code> values<a class="anchor" aria-label="anchor" href="#reformatting-map-with-null-values"></a>
</h2>
<p>Reformatting functions tolerate <code>NULL</code> values in the
reformatting maps. In the following example, the table <code>df2</code>
will be left unchanged as well as the <code>logi</code> column of the
<code>df1</code> table. In the <code>char</code> column, only
<code>a</code> and <code>k</code> will be reformatted and the column
changed to <code>factor</code>. <code>B</code> wont be included in the
levels.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># This is a valid reformatting map</span></span>
<span><span class="va">null_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  df1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    char <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"k"</span><span class="op">)</span>,</span>
<span>      <span class="st">"B"</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span>,</span>
<span>    logi <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span>,</span>
<span>  df2 <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/assert_reformat.html">assert_reformat</a></span><span class="op">(</span><span class="va">null_map</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Benoit Falquet, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
